A BIG thanks to the https://www.facebook.com/groups/SHgruppen on Facebook and a special superduper thanks to the core coder @[strigeus](https://github.com/strigeus)!
https://github.com/strigeus/sparsnas_decoder

Also kudo to @[tubalainen](https://github.com/tubalainen) who made a fork adapted for output in JSON format to a MQTT broker!
https://github.com/tubalainen/sparsnas_decoder

If you want to implement the same thing as below into an ESP8266 please see the following project: https://github.com/bphermansson/EspSparsnasGateway

If you want to get into the bits and bytes of the system please see:
https://github.com/kodarn/Sparsnas

This is a decoder for IKEA SPARSNÄS 
(Hass.io Add-On.)
===================================

It uses RTL-SDR running on a Raspberry Pi to demodulate the FSK signal, and decodes the packet.

The packet data is encrypted using your sender's ID. The sender ID is the last 6 digits of the serial number located under the battery.

Prerequisites:
-------------
Tested on a Raspberry Pi 3 with hass.io using a NooElec Micro 3 USB SDR dongle. You should be able to use any RTL-SDR compatible dongle.

An IKEA Sparsnäs unit (duuh)

An MQTT broker installed, see this video for support/help to get it going: https://www.youtube.com/watch?v=VaWdvVVYU3A

A suggestion would be to use the Hass.io Add-On [Mosquitto broker](https://www.home-assistant.io/addons/mosquitto/)

You can also pipe your MQTT data via node-red to InfluxDB for diplaying in for example Grafana, @[Naesstrom](https://github.com/Naesstrom) have done a great job creating a node-red flow, please find more info here: https://github.com/Naesstrom/sparsnas_mqtt_nodered_influxdb

The installation:
-------------
Add this repository to hass.io - [click here for guide](https://www.home-assistant.io/hassio/installing_third_party_addons/).

Use the following url: [https://github.com/asifma/hassio-addons](https://github.com/asifma/hassio-addons)

Make sure to edit the default config before starting the Add-On

```sh
{
  "SENSORS": "123456 1000",
  "MQTT_HOST": "192.168.x.x",
  "MQTT_PORT": 1883,
  "MQTT_USERNAME": "user",
  "MQTT_PASSWORD": "pass"
}
```
Outcome should look something like this:

    SENSORS = 123456 1000
    MQTT HOST = 192.168.x.x
    MQTT PORT = 1883
    MQTT USERNAME = user
    MQTT PASSWORD = pass
    grep: /tmp/123456.freq: No such file or directory
    Need to find frequencies
    Found 1 device(s):
      0:  Realtek, RTL2838UHIDIR, SN: 00000001
    Using device 0: Generic RTL2832U OEM
    Found Fitipower FC0012 tuner
    Sampling at 1024000 S/s.
    Tuned to 868000000 Hz.
    Tuner gain set to 19.20 dB.
    Reading samples in async mode...
    Signal caught, exiting!
    User cancel, exiting...
    Trying -100000 hz...
    Trying -95000 hz...
    Trying -90000 hz...
    Trying -85000 hz...
    Trying -80000 hz...
    Trying -75000 hz...
    Trying -70000 hz...
    Trying -65000 hz...
    Trying -60000 hz...
    Trying -55000 hz...
    Trying -50000 hz...
    Trying -45000 hz...
    Trying -40000 hz...
    Trying -35000 hz...
    Trying -30000 hz...
    Trying -25000 hz...
    Trying -20000 hz...
    Trying -15000 hz...
    Trying -10000 hz...
    Trying -5000 hz...
    Trying 0 hz...
    Trying 5000 hz...
    Trying 10000 hz...
    Trying 15000 hz...
    Freq 15000 gives error 8.290112
    Trying 20000 hz...
    Freq 20000 gives error 3.590892
    Trying 25000 hz...
    Freq 25000 gives error 1.723408
    Trying 30000 hz...
    Trying 35000 hz...
    Trying 40000 hz...
    Trying 45000 hz...
    Trying 50000 hz...
    Trying 55000 hz...
    Trying 60000 hz...
    Trying 65000 hz...
    Trying 70000 hz...
    Trying 75000 hz...
    Trying 80000 hz...
    Trying 85000 hz...
    Trying 90000 hz...
    Trying 95000 hz...
    Trying 100000 hz...
    Trying 22500 hz...
    Freq 22500 gives error 0.880871
    Trying 23000 hz...
    Freq 23000 gives error 0.661838
    Trying 23500 hz...
    Freq 23500 gives error 0.115052
    Trying 24000 hz...
    Trying 24500 hz...
    Trying 25000 hz...
    Trying 25500 hz...
    Trying 26000 hz...
    Trying 26500 hz...
    Trying 27000 hz...
    Trying 27500 hz...
    Trying 23250 hz...
    Freq 23250 gives error 0.207723
    Trying 23300 hz...
    Freq 23300 gives error 0.194406
    Trying 23350 hz...
    Freq 23350 gives error 0.096824
    Trying 23400 hz...
    Trying 23450 hz...
    Trying 23500 hz...
    Trying 23550 hz...
    Trying 23600 hz...
    Trying 23650 hz...
    Trying 23700 hz...
    Trying 23750 hz...
    #define FREQUENCIES {xxxxx.000000, xxxxx.000000}
    Found 1 device(s):
      0:  Realtek, RTL2838UHIDIR, SN: 00000001
    Using device 0: Generic RTL2832U OEM
    Found Fitipower FC0012 tuner
    Sampling at 1024000 S/s.
    Tuned to 868000000 Hz.
    Tuner gain set to 19.20 dB.
    Reading samples in async mode...

Check status and traffic on your MQTT broker:
```sh
mosquitto_sub -v -h 192.168.x.x -u username -P password -t '#'
```
Example of outcome:
```json
core-ssh:~# mosquitto_sub -v -h 192.168.x.x -u username -P password -t '#'
sparsnas/602064 {"Sequence": 47318,"Watt": 2424.00,"kWh": 4207.933,"battery": 100,"FreqErr": 0.70,"CRC":"ok","Sensor":602064}
sparsnas/722270 {"Sequence":    77,"Watt": 3245.07,"kWh":    0.483,"battery": 100,"FreqErr": 0.40,"CRC":"ok","Sensor":722270}
```

To configure Home Assistant with MQTT sensors [click here for a great guide](https://github.com/tubalainen/sparsnas_decoder/tree/master/home-assistant).
